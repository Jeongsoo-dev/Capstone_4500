# 模块至上位机
模块默认上传 Flag=0x61(加速度 角速度 角度)的数据。 Flag=0x71(磁场) 需要发送读取对应寄存器指令才能回传。 蓝牙上传数据格式：蓝牙每次上传数据最大 28Bytes。
# 加速度 角速度 角度 数据包（默认）
| 数据包头  1Byte | 标志位  1Byte | axL | axH | ...... | YawL | YawH |
| --- | --- | --- | --- | --- | --- | --- |
| 0x55 | Flag | 0xNN | 0xNN | ...... | 0xNN | 0xNN |

注：0xNN 是收到的具体数值,数据回传顺序为加速度 X Y Z，角速度 X Y Z，角度 XYZ, 低字节在前，高字节在后。 Flag = 0x61 数据内容 18Byte 为加速度，角速度，角度

| 地址 | 定义 |
| --- | --- |
| 0x55 | 数据包头 |
| 0x61 | 标志位 |
| axL | X 轴加速度低 8 位 |
| axH | X 轴加速度高 8 位 |
| ayL | Y 轴加速度低 8 位 |
| ayH | Y 轴加速度高 8 位 |
| azL | Z 轴加速度低 8 位 |
| azH | Z 轴加速度高 8 位 |
| wxL | X 轴角速度低 8 位 |
| wxH | X 轴角速度高 8 位 |
| wyL | Y 轴角速度低 8 位 |
| wyH | Y 轴角速度高 8 位 |
| wzL | Z 轴角速度低 8 位 |
| wzH | Z 轴角速度高 8 位 |
| RollL | X 轴角度低 8 位 |
| RollH | X 轴角度高 8 位 |
| PitchL | Y 轴角度低 8 位 |
| PitchH | Y 轴角度高 8 位 |
| YawL | Z 轴角度低 8 位 |
| YawH | Z 轴角度高 8 位 |
| YY | 年 |
| MM | 月 |
| DD | 日 |
| HH | 时 |
| MN | 分 |
| SS | 秒 |
| MSL | 毫秒低8位 |
| MSH | 毫秒高8位 |

### 加速度计算方法：单位 g 
ax=((axH&lt;&lt;8)|axL)/32768*16g(g 为重力加速度，可取 9.8m/s2)

ay=((ayH&lt;&lt;8)|ayL)/32768*16g(g 为重力加速度，可取 9.8m/s2) 

az=((azH&lt;&lt;8)|azL)/32768*16g(g 为重力加速度，可取 9.8m/s2) 

### 角速度计算方法：单位 °/s
wx=((wxH&lt;&lt;8)|wxL)/32768*2000(°/s) 

wy=((wyH&lt;&lt;8)|wyL)/32768*2000(°/s) 

wz=((wzH&lt;&lt;8)|wzL)/32768*2000(°/s) 

### 角度计算方法：单位 ° 
滚转角（x 轴）Roll=((RollH&lt;&lt;8)|RollL)/32768*180(°) 

俯仰角（y 轴）Pitch=((PitchH&lt;&lt;8)|PitchL)/32768*180(°) 

偏航角（z 轴）Yaw=((YawH&lt;&lt;8)|YawL)/32768*180(°) 

注：
1. 姿态角结算时所使用的坐标系为东北天坐标系，正方向放置模块,如“4 引脚说明” 所示向左为 X 轴，向前为 Y 轴，向上为 Z 轴。欧拉角表示姿态时的坐标系旋转顺序 定义为为 Z-Y-X,即先绕 Z 轴转，再绕 Y 轴转，再绕 X 轴转。 

2. 滚转角的范围虽然是±180 度，但实际上由于坐标旋转顺序是 Z-Y-X，在表示姿态 的时候，俯仰角(Y 轴)的范围只有±90 度，超过 90 度后会变换到小于 90 度，同时 让X轴的角度大于180度。详细原理请大家自行百度欧拉角及姿态表示的相关信息。 

3. 由于三轴是耦合的，只有在小角度的时候会表现出独立变化，在大角度的时候姿态 角度会耦合变化，比如当 Y 轴接近 90 度时，即使姿态只绕 Y 轴转动，X 轴的角度 也会跟着发生较大变化，这是欧拉角表示姿态的固有特性。 

说明： 
1、 数据是按照 16 进制方式发送的，不是 ASCII 码。 

2、 每个数据分低字节和高字节依次传送，二者组合成一个有符号的 short类型的数据。 例如 X 轴加速度数据 Ax，其中 AxL 为低字节，AxH 为高字节。转换方法如下： 假设 Data 为实际的数据，DataH 为其高字节部分，DataL 为其低字节部分， 那么： Data=((short)DataH&lt;&lt;8)|DataL。这里一定要注意 DataH 需要先强制转换为一个有符号的 short 类型的数据以后再移位，并且 Data 的数据类型也是有符号的 short 类型，这样才能表示出 负数。

### 时间计算方法
毫秒计算公式：毫秒=((MSH&lt;&lt;8)|MSL)注：1.时间均为16进制，需要转换成10进制进行解读。


# 单次回传寄存器的数据包
单次回传的数据包需要先发送读取寄存器指令，指令格式如下：| FF  AA  27  XX  00 |

--XX 指的是对应寄存器编号，寄存器的编号数值参考，发送指令示例如下：

| 功能 | 指令 |
| --- | --- |
| 读 取 磁 场 | FF AA 27 3A 00 |
| 读 取 四 元 素 | FF AA 27 51 00 |
| 读 取 温 度 | FF AA 27 40 00 |
| 读 取 电 量 | FF AA 27 64 00 |

发送此指令后，模块会回传一次 0x55 0x71 开头的数据包，内有对应开始寄存器地址 数据、开始寄存器地址开始以及后面 7 个寄存器数据(固定上传 8 个寄存器），回传数据格式如下：开始寄存器（2Byte）+寄存器数据(16Byte,8 个寄存器)

| 包头 | 标志 | 开始寄存器地址低位 | 开始寄存器地址高位 | 开始（第1个)寄存器数据低位 | 开（第1个)寄存器数高位 | ...... | 第8个寄存器数据低位 | 第8个寄存器数据高位 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0x55 | 0x71 | RegL | RegH | 0xNN | 0xNN | ...... | 0xNN | 0xNN |

注：0xNN 是收到的具体数值，低字节在前，高字节在后。


### 磁场输出
注：原始数据计算得出来的磁场数据单位是毫高斯，和电脑上位机显示的单位是不一样的，如果需要转换和上位机一样的单位需要根据下面这个计算方式去计算。1.磁场原始数据单位转换公式链接

| 0x55 | 0x71 | 0x3A | 0x00 | HxL | HxH | HyL | HyH | HzL | HzH..... |

计算方法：单位 mG 磁场（x 轴）Hx=(( HxH&lt;&lt;8)| HxL) 磁场（y 轴）Hy=(( HyH &lt;&lt;8)| HyL) 磁场（z 轴）Hz =(( HzH&lt;&lt;8)| HzL) 例：在 APP 上发送读取磁场指令：FF AA 27 3A 00（参考 7.2.8 读取寄存器值） 模块回传数据至 APP：55 71 3A 00 68 01 69 00 7A 00 00 00 00 00 00 00 00 00 00 00 共 20 个字节。对第 5 至第 10 个字节按上述解算,磁场 x=360，y=105,z=122。

### 四元数输出
| 0x55 | 0x71 | 0x51 | 0x00 | QxL | QxH | QyL | QyH | QzL | QzH..... |

计算方法： Q0=((Q0H&lt;&lt;8)|Q0L)/32768 Q1=((Q1H&lt;&lt;8)|Q1L)/32768 Q2=((Q2H&lt;&lt;8)|Q2L)/32768 Q3=((Q3H&lt;&lt;8)|Q3L)/32768 

校验和： Sum=0x55+0x59+Q0L+Q0H+Q1L +Q1H +Q2L+Q2H+Q3L+Q3H

### 温度输出
| 0x55 | 0x71 | 0x40 | 0x00 | TL | TH | ...... |

温度计算公式： T=((TH&lt;&lt;8)|TL) /100 ℃ 
# 上位机至模块

## 发送指令：

### 读取寄存器值
| FF AA 27 XX 00 | 读取寄存器值 |

--XX 指的是对应寄存器。例：读 取 磁 场：FF AA 27 3A 00 读 取 四 元 素：FF AA 27 51 00 读 取 温 度：FF AA 27 40 00 发送此指令后，模块会回传一次 0x55 0x71 开头的数据包，内有对应开始寄存器地址 数据、开始寄存器地址开始以及后面 7 个寄存器数据(固定上传 8 个寄存器），回传数据格式参考

### 加速度校准与磁场校准
| FF AA 01 01 00 | 加速度计校准 |

### 保存配置
| FF AA 00 SAVE 00 | 保存配置 |

SAVE：设置 0：保存当前配置 1：恢复默认配置并保存
### 设置回传速率
| FF AA 03 RATE 00 | 设置回传速率 |

RATE：回传速率 0x01：0.1Hz 0x02：0.5Hz 0x03：1Hz 0x04：2Hz 0x05：5Hz 0x06：10Hz（默认） 0x07：20Hz 0x08：50Hz 0x09：100Hz 0x0A：200Hz

### 设置角度参考
| FF AA 01 08 00 | 设置角度参考 |

发送后，需要发送保存指令

### 设置Z轴角度归零
| FF AA 01 04 00 | 设置z轴角度归零 |

发送这个指令前需要先切换六轴算法，才可以生效。
### 设置安装方向
| FF AA 23 ORIENT 00 | 设置安装方向 |

ORIENT ：安装方向0(0x00): 水平安装1(0x01): 垂直安装（必须坐标轴的Y轴箭头朝上）
### 读取电量
| FF AA 27 64 00 | 读取模块电量 |

电压和电量百分比对应关系为：

| 寄存器值 | 电压值 | 电量百分比 |
| --- | --- | --- |
| &gt;396 | &gt; 3.96V | 100% |
| 393-396 | 3.93V-3.96V | 90% |
| 387-393 | 3.87V-3.93V | 75% |
| 382-387 | 3.82V-3.87V | 60% |
| 379-382 | 3.79V-3.82V | 50% |
| 377-379 | 3.77V-3.79V | 40% |
| 373-377 | 3.73V-3.77V | 30% |
| 370-373 | 3.70V-3.73V | 20% |
| 368-370 | 3.68V-3.70V | 15% |
| 350-368 | 3.50V-3.68V | 10% |
| 340-350 | 3.40V-3.50V | 5% |
| &lt;340 | &lt;3.40V | 0% |

## 寄存器地址表

| 地址 | 符号 | 含义 |
| --- | --- | --- |
| 0x00 | SAVE | 保存当前配置 |
| 0x01 | CALSW | 校准 |
| 0x02 | 保留 |
| 0x03 | RATE | 回传数据速率 |
| 0x04 | BAUD | 串口波特率 |
| 0x05 | AXOFFSET | X 轴加速度零偏 |
| 0x06 | AYOFFSET | Y 轴加速度零偏 |
| 0x07 | AZOFFSET | Z 轴加速度零偏 |
| 0x08 | GXOFFSET | X 轴角速度零偏 |
| 0x09 | GYOFFSET | Y 轴角速度零偏 |
| 0x0a | GZOFFSET | Z 轴角速度零偏 |
| 0x0b | HXOFFSET | X 轴磁场零偏 |
| 0x0c | HYOFFSET | Y 轴磁场零偏 |
| 0x0d | HZOFFSET | Z 轴磁场零偏 |
| 0x0e | D0MODE | D0 模式 |
| 0x0f | D1MODE | D1 模式 |
| 0x10 | D2MODE | D2 模式 |
| 0x11 | D3MODE | D3 模式 |
| 0x12 | 保留 |
| 0x13 | 保留 |
| 0x14 | 保留 |
| 0x15 | 保留 |
| 0x16 | 保留 |
| 0x17 | 保留 |
| 0x18 | 保留 |
| 0x19 | 保留 |
| 0x1a | 保留 |
| 0x1b | 保留 |
| ...... | ...... | ...... |
| 0x30 | YYMM | 年、月 |
| 0x31 | DDHH | 日、时 |
| 0x32 | MMSS | 分、秒 |
| 0x33 | MS | 毫秒 |
| 0x34 | AX | X 轴加速度 |
| 0x35 | AY | Y 轴加速度 |
| 0x36 | AZ | Z 轴加速度 |
| 0x37 | GX | X 轴角速度 |
| 0x38 | GY | Y 轴角速度 |
| 0x39 | GZ | Z 轴角速度 |
| 0x3a | HX | X 轴磁场 |
| 0x3b | HY | Y 轴磁场 |
| 0x3c | HZ | Z 轴磁场 |
| 0x3d | Roll | X 轴角度 |
| 0x3e | Pitch | Y 轴角度 |
| 0x3f | Yaw | Z 轴角度 |
| 0x40 | TEMP | 模块温度 |
| 0x49 | 保留 |
| 0x4a | 保留 |
| 0x4b | 保留 |
| 0x4c | 保留 |
| 0x4d | 保留 |
| 0x4e | 保留 |
| 0x4f | 保留 |
| 0x50 | 保留 |
| 0x51 | Q0 | 四元素 Q0 |
| 0x52 | Q1 | 四元素 Q1 |
| 0x53 | Q2 | 四元素 Q2 |
| 0x54 | Q3 | 四元素 Q3 |


# WT901SDCL-BT50记录协议

## 读文件列表
发送：FF AA 5A 01 00返回：55 AA   WIT__.TXT  0D 0A
## 读文件内容
读取文件长度指令55 BB   WIT__.TXT  0D 0A返回&gt;&gt;55 BB   WIT__.TXT   3A ___包数___ 0D 0A(包数：文件中的字节总数 / 每包200Bytes，例：包数=801 / 200 = 5，第5包仅1个字节)（发送此指令前需发送上一个读取文件长度指令，否则无法识别读取哪一个文件）开始读取文件指令FF AA 5B 01 00     (无返回)读取文件内容指令55 FF 00 00           (55 FF 包数，包数为16Bit，最大长度65536包，即13M左右)55 FF 00 01.......55 FF FF FF返回&gt;&gt;55 FF 00 00 ___________________200Bytes数据_______________________________________55 FF 00 01 ___________________200Bytes数据_______________________________________.......55 FF FF FF ________最后一包数据_________________________________App停止读取文件指令FF AA 5B 02 00     (无返回)